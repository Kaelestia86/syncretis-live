<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Realms of Syncretis ‚Äì Live Session</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app">
    <header>
      <h1>Realms of Syncretis ‚Äì Live Session</h1>
    </header>

    <section id="connectSection">
      <h2>Connect</h2>

      <div class="row">
        <label>Session ID:
          <input type="text" id="sessionIdInput" placeholder="e.g. ECHO-1" />
        </label>
      </div>

      <div class="row">
        <label>Name:
          <input type="text" id="playerNameInput" placeholder="Your Warden name" />
        </label>
      </div>

      <div class="row">
        <label>Race:
          <select id="raceSelect">
            <option value="">-- Select Race --</option>
            <option value="Aethrial">Aethrial</option>
            <option value="Vey'ruun">Vey'ruun</option>
            <option value="Lumirite">Lumirite</option>
            <option value="Dralith">Dralith</option>
          </select>
        </label>
      </div>

      <div class="row">
        <label>Class:
          <select id="classSelect">
            <option value="">-- Select Class --</option>

            <optgroup label="Claws of Dragoon">
              <option value="Talons of Dragoon">Talons of Dragoon</option>
              <option value="Scales of Dragoon">Scales of Dragoon</option>
              <option value="Eyes of Dragoon">Eyes of Dragoon</option>
            </optgroup>

            <optgroup label="Heart of Dragoon">
              <option value="Tempest Weaver">Tempest Weaver</option>
              <option value="Ember Sage">Ember Sage</option>
              <option value="Heart-Stone">Heart-Stone</option>
              <option value="Tears">Tears</option>
            </optgroup>

            <optgroup label="Shades of Dragoon">
              <option value="Eclipsar">Eclipsar</option>
              <option value="Rhythm of Dragoon">Rhythm of Dragoon</option>
              <option value="Shadow Weaver">Shadow Weaver</option>
            </optgroup>

            <optgroup label="Other / Custom">
              <option value="Custom Warden">Custom Warden</option>
            </optgroup>

          </select>
        </label>
      </div>

      <div class="row">
        <label>
          <input type="checkbox" id="isSwCheckbox" />
          I am the Story Weaver
        </label>
      </div>

      <button id="joinBtn">Join Session</button>
      <button id="rejoinBtn">Rejoin Saved Session</button>
      <div id="connectStatus"></div>
    </section>

    <nav id="mainNav" class="hidden">
      <button data-tab="playerTab">Player</button>
      <button data-tab="storyWeaverTab" id="swTabButton">Story Weaver</button>
    </nav>

    <main>
      <section id="playerTab" class="tab hidden">
        <h2>Player Panel</h2>

        <div id="playerInfo">
          <p><strong>Name:</strong> <span id="playerNameDisplay">‚Äî</span></p>
          <p><strong>Race:</strong> <span id="playerRaceDisplay">‚Äî</span></p>
          <p><strong>Class:</strong> <span id="playerClassDisplay">‚Äî</span></p>
          <p><strong>HP:</strong> <span id="hpDisplay">‚Äî</span></p>
          <p><strong>Level:</strong> <span id="levelDisplay">‚Äî</span></p>
        </div>

        <section id="nexusSection" class="stat-block">
          <h3>Nexus</h3>
          <div class="nexus-display">
            <span id="nexusValue">40</span> / <span id="maxNexusValue">40</span>
          </div>
          <div class="nexus-buttons">
            <button onclick="changeNexus(+1)">+1</button>
            <button onclick="changeNexus(-1)">-1</button>
            <button onclick="resetNexus()">Reset</button>
          </div>
        </section>

        <section id="stressSection" class="stat-block">
          <h3>Stress</h3>
          <div id="stressBar" class="stress-bar"></div>
          <div class="stress-buttons">
            <button onclick="changeStress(+1)">+1</button>
            <button onclick="changeStress(-1)">-1</button>
            <button onclick="resetStress()">Reset</button>
          </div>
        </section>

        <section id="diceRoller">
          <h3>üé≤ Dice Roller</h3>

          <label>
            # Dice:
            <input id="diceCountInput" type="number" min="1" max="20" value="1">
          </label>

          <button class="die-btn" data-die="6">Roll D6</button>
          <button class="die-btn" data-die="10">Roll D10</button>
          <button class="die-btn" data-die="20">Roll D20</button>
          <div id="diceResults"></div>
        </section>

        <section id="classSkills" class="stat-block">
          <h3>Class Skills</h3>
          <p id="classSkillsHint" class="skills-hint">
            Select a class above, then click a skill to roll (odds = success), spend Nexus, roll damage.
          </p>
          <div id="skillsContainer"></div>
          <div id="skillResult" class="skill-result"></div>
        </section>

        <section id="levelControls">
          <h3>‚¨ÜÔ∏è Level Controls</h3>
          <button id="levelUpBtn">Level Up (3d6 HP)</button>
          <button id="levelDownBtn">Level Down (undo last)</button>
        </section>

        <section id="playersListSection">
          <h3>Party</h3>
          <ul id="playersList" class="player-list"></ul>
        </section>
      </section>

      <section id="storyWeaverTab" class="tab hidden">
        <h2>üìú Story Weaver</h2>

        <section>
          <h3>Map</h3>
          <div id="mapDisplay">No map selected.</div>
          <div id="swMapControls">
            <input type="text" id="mapUrlInput" placeholder="Paste map image URL..." />
            <button id="setMapBtn">Set Map</button>
          </div>
        </section>

        <section>
          <h3>Conflict Management</h3>
          <div id="conflictInfo">No active conflict.</div>

          <!-- ‚úÖ NEW: Add Enemy Controls -->
          <h4>Add Enemy</h4>
          <div class="row">
            <label>Enemy:
              <select id="enemySelect">
                <option value="">-- Select Enemy --</option>
              </select>
            </label>
            <button id="addEnemyBtn">Add Enemy</button>
          </div>

          <!-- ‚úÖ Enemies -->
          <h4>Enemies</h4>
          <div id="enemyPanel"></div>

          <!-- ‚úÖ Combat Log -->
          <h4>Combat Log</h4>
          <div id="combatLog"></div>

          <input type="text" id="conflictNameInput" placeholder="Conflict name..." />
          <button id="startConflictBtn">Start Conflict</button>
          <button id="endConflictBtn">End Conflict</button>
        </section>
      </section>
    </main>
  </div>

  <!-- ‚úÖ Load enemy defs BEFORE client.js -->
  <script src="enemy_defs.js"></script>
  <script src="client.js"></script>

  <!-- ‚úÖ Small inline script to populate dropdown + wire button -->
  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const enemySelect = document.getElementById("enemySelect");
      const addEnemyBtn = document.getElementById("addEnemyBtn");

      // Populate enemy dropdown from window.ENEMY_DEFS
      const defs = window.ENEMY_DEFS || {};
      if (enemySelect) {
        Object.keys(defs).forEach((key) => {
          const opt = document.createElement("option");
          opt.value = key;
          opt.textContent = defs[key]?.name || key;
          enemySelect.appendChild(opt);
        });
      }

      // When clicked, emit a custom event that client.js can hook
      if (addEnemyBtn) {
        addEnemyBtn.addEventListener("click", () => {
          const key = enemySelect ? enemySelect.value : "";
          if (!key) return alert("Pick an enemy first.");

          // Let client.js handle sessionId + sendMsg
          window.dispatchEvent(new CustomEvent("ros:addEnemy", { detail: { enemyKey: key } }));
        });
      }
    });
  </script>
</body>
</html>
